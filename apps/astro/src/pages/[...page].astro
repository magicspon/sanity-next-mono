---
import { runQuery } from 'cms/lib/runner';
import Layout from '../layouts/Layout.astro';
import { getPageMetaData } from 'cms/queries/tree'
import { listingQuery } from 'cms/queries/pages/listing.query'
import { pageQuery } from 'cms/queries/pages/page.query'

const { page } = Astro.params
const pageMeta = await getPageMetaData(`/${page}` as string)

if(!pageMeta) {
	return new Response(null, {
    status: 404,
    statusText: 'Not found'
  });
}

const { _id: id, type } = pageMeta

const args = {
	page: { id },
	listing: { id },
}


const arg = args[type]
const data =
	type === 'listing'
		? await runQuery(listingQuery, arg)
		: await runQuery(pageQuery, arg)


---

<Layout title="Welcome to Astro.">
	<pre>{JSON.stringify({data, id}, null, 2)}</pre>
</Layout>
